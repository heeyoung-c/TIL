# node.js

```js
const fs = require('fs')
const marked = require('marked')
const yaml = require('js-yaml')
const jsdom = require('jsdom')
const { JSDOM } = jsdom

const mdDir = `${__dirname}/markdowns`
const htmlDir = `${__dirname}/dist`
const indexHTML = fs.readFileSync(`${__dirname}/index.html`, { encoding: 'utf8' })

if (fs.existsSync(htmlDir)) { // dist 폴더 생성
  fs.rmdirSync(htmlDir, { recursive: true }) // 재귀를 사용한 이유? rm -rf 와 동일!! 파일 안에 파일이 있어도 계속 들어가서 지워라!
} 
fs.mkdirSync(htmlDir)

const mds = fs.readdirSync(mdDir) // 폴더 읽기
// mds => [ 'abc.md', 'xyz.md ]

mds.forEach(file => {
  // file => 'abc.md' || 'xyz.md'
  let md = fs.readFileSync(`${mdDir}/${file}`, { encoding: 'utf8' }) //md는 각각의 파일을 utf8로 인코딩 해 온 값이다
  const headers = getHeaders(md) // 헤더 부분을 가져온다
  md = removeHeaders(md, headers) // 위에서 가져온 내용을 바탕으로 md에서 헤더 내용 제거
  const { title } = yaml.load(headers) // 헤더에서 title추출
  const dom = new JSDOM(indexHTML) // 여기서 indexHTML은 문자데이터이다. 그 문자를 JSDOM으로 넣어주면 거기서 dom 객체가 나온다 

  const html = marked.parse(md) // md 파일이 html구조로 변환된다, 즉 정적으로 md파일이 html이 된 것!
  dom.window.document.querySelector('title').innerHTML = title
  dom.window.document.body.innerHTML = html 
  // 이걸 작성하였기 때문에, 바로 밑에 있는 코드를 사용할 필요가 없다. 아래 코드는 indexHTML이 문자데이터였기 때문에 사용한 것이지만, jsdom라이브러리를 사용하여 이렇게 바꾸면 된다
  // const data = indexHTML.replace('</body>', `${html}</body>`) // html `body` 안에 내용 넣기
  // jsdom이라는 패키지는 가상돔을 만들어서 실제 html 구조에 접근을 할 수 있다

  const filename = file.replace('.md', '')
  fs.mkdirSync(`${htmlDir}/${filename}`)
  fs.writeFileSync(`${htmlDir}/${filename}/index.html`, dom.serialize()) // fs.writeFileSync(경로, 데이터) 
})

function getHeaders(md) {
  return md.split('---').filter(s => s)[0] // 해당 문자를 기준으로 배열이 반환된다, filter를 돌려서 빈문자는 걸러준다
}
function removeHeaders(md, headers) {
  return md.replace('---' + headers + '---', '') // md에 생성된 해더 영역 잡아서 제거!
}
```